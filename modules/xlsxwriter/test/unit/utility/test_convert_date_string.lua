----
-- Tests for the xlsxwriter.lua xml utility class.
--
-- Copyright 2014, John McNamara, jmcnamara@cpan.org
--

require "Test.More"

local utility = require "xlsxwriter.utility"
local expected
local got
local caption
local expected_t
local got_t
local tests

plan(1)

----
-- Test the utility convert_date_string function.
--

-- Test various date strings.
tests = {
  {"1899-12-31T",                              0},
  {"1900-01-01T",                              1},
  {"2001-11-30T",                          37225},
  {"1899-12-31",                               0},
  {"1900-01-01",                               1},
  {"2001-11-30",                           37225},
  {"1982-08-25T00:15:20.213", 30188.010650613425},
  {"2065-04-19T00:16:48.290", 60376.011670023145},
  {"2147-12-15T00:55:25.446", 90565.038488958337},
  {"2230-08-10T01:02:46.891", 120753.04359827546},
  {"2313-04-06T01:04:15.597", 150942.04462496529},
  {"2395-11-30T01:09:40.889", 181130.04838991899},
  {"2478-07-25T01:11:32.560", 211318.04968240741},
  {"2561-03-21T01:30:19.169", 241507.06272186342},
  {"2643-11-15T01:48:25.580", 271695.07529606484},
  {"2726-07-12T02:03:31.919", 301884.08578609955},
  {"2809-03-06T02:11:11.986", 332072.09111094906},
  {"2891-10-31T02:24:37.095", 362261.10042934027},
  {"2974-06-26T02:35:07.220", 392449.10772245371},
  {"3057-02-19T02:45:12.109", 422637.11472348380},
  {"3139-10-17T03:06:39.990", 452826.12962951389},
  {"09:54:22.108",            0.41275587962962962},
  {"10:01:36.151",            0.41777952546296299},
  {"12:09:48.602",            0.50681252314814818},
  {"12:34:08.549",            0.52371005787037039},
  {"12:56:06.495",            0.53896406249999995},
  {"1899-12-31T21:46:07.769", 0.90703436342592603},
  {"1899-12-31T21:57:55.662", 0.91522756944444439},
  {"1899-12-31T22:19:11.732", 0.92999689814814823},
  {"1899-12-31T22:23:51.376", 0.93323351851851843},
  {"1899-12-31T22:27:58.771", 0.93609688657407408},
  {"1899-12-31T22:43:30.392", 0.94687953703703709},
}

got_t      = {}
expected_t = {}

for _, test in ipairs(tests) do
  got      = utility.convert_date_string(test[1])
  expected = test[2]

  -- Round to double precision before comparison.
  got      = string.format("%g", got)
  expected = string.format("%g", expected)

  table.insert(got_t, got)
  table.insert(expected_t, expected)

end

caption  = " \tconvert_date_string()"
eq_array(got_t, expected_t, caption)
